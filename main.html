<!doctype html> 
<html lang="en"> 
<head> 
  <meta charset="UTF-8" />
    <title>Cursed Bricks of the Ancient</title>
    <script type="text/javascript" src="vendor/phaser.min.js"></script>
    <script type="text/javascript" src="src/component.js"></script>
    <script type="text/javascript" src="src/square.js"></script>
    <script type="text/javascript" src="src/template.js"></script>
    <script type="text/javascript" src="src/levels.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>
  <div id="ld36">
  </div>
</body>

<script type="text/javascript">
  var game = new Phaser.Game(800, 600, Phaser.CANVAS, 'ld36', { preload: preload, create: create });

  function preload() {
    // for each asset you must load image
    game.load.image('square+raw_1x2', 'assets/ld36_square+raw_1x2_001.png');
    game.load.image('square+raw_2x1', 'assets/ld36_square+raw_2x1_001.png');
    game.load.image('square+raw_1x1', 'assets/ld36_square+raw_1x1_001.png');
    game.load.image('ld36_bg_001', 'assets/ld36_bg_001.png');
    game.load.image('ld36_blueprint_001', 'assets/ld36_blueprint_001.png');
    game.load.image('ld36_win_001', 'assets/ld36_win_001.png');
    game.load.image('ld36_slots_001', 'assets/ld36_slots_001.png');
  }

  function create() {
    game.stage.backgroundColor = '#FFFFFF';
    game.add.image(0, 0, 'ld36_bg_001');
    var slotsImg = game.add.image(580, 175, 'ld36_slots_001');
    slotsImg.blendMode = PIXI.blendModes.COLOR_BURN;
    var texts = ["Start", "Level 1 \nPyramid"];
    chainedTextsWithFinalTrigger(590,20, texts, firstLevel);
  }

  function firstLevel() {
    template = new Template(game, 'Pyramid', PYRAMIDE_GRID, 'ld36_blueprint_001');
    template.graphicGrid.visible = false;
    template.spawnsThreeComponents();
  }

  function chainedTextsWithFinalTrigger(x, y, texts, triggerMethod) {
    var current = 0;
    lastText = game.add.text(x, y, texts[current], { font: "30px Georgia", fill: "#000000", align: "center", boundsAlignH: "center", boundsAlignV: "middle"});
    lastText.setTextBounds(0, 0, 200, 115);
    current = current + 1;
    game.input.onDown.addOnce(showNext, {x: x, y: y, lastText: lastText, texts: texts, current: current, method: triggerMethod}, this);
  }

  function showNext() {
    this.lastText.destroy()
    this.lastText = game.add.text(this.x, this.y, this.texts[this.current], { font: "30px Georgia", fill: "#000000", align: "center", boundsAlignH: "center", boundsAlignV: "middle" });
    this.lastText.setTextBounds(0, 0, 200, 115);
    this.current = this.current + 1;
    if (this.current <= this.texts.length) {
      game.input.onDown.addOnce(showNext, {x: this.x, y: this.y, lastText: this.lastText, texts: this.texts, current: this.current, method: this.method}, this);
    } else {
      this.method();
    }
  }
</script>
