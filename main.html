<!doctype html> 
<html lang="en"> 
<head> 
  <meta charset="UTF-8" />
  <title>Cursed bricks of the Ancient</title>
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon">
  <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="style/style.css" type="text/css">
  <script type="text/javascript" src="vendor/phaser.min.js"></script>
  <script type="text/javascript" src="data/parameters.js"></script>
  <script type="text/javascript" src="src/helper.js"></script>
  <script type="text/javascript" src="src/component.js"></script>
  <script type="text/javascript" src="src/square.js"></script>
  <script type="text/javascript" src="src/template.js"></script>
  <script type="text/javascript" src="src/grid.js"></script>
  <script type="text/javascript" src="src/levels.js"></script>
</head>
<body>
  <div id="ld36">
  </div>
  <p>
    A <s>game</s> toy made in less than 48h for the <a href="http://ludumdare.com/compo/">Ludum Dare 36</a> by <a href="https://github.com/tsandras">Tristan Sandras</a> & <a href="http://www.miryamhouali.com">Miryam Houali</a>. 
  <p>
  </p>
	Music by <a href="http://david.fonteix.free.fr/">David Fonteix</a>
  </p>
  <p>
    See on <a href="https://github.com/tsandras/ld36">Git Hub</a>
  </p>
</body>

<script type="text/javascript">
  var game = new Phaser.Game(GAME_WIDTH, GAME_HEIGHT, Phaser.CANVAS, 'ld36', { preload: preload, create: create });
  function preload() {
    // for each asset you must load image
    game.load.image('square+raw_1x2', 'assets/ld36_square+raw_1x2_001.png');
    game.load.image('square+raw_2x1', 'assets/ld36_square+raw_2x1_001.png');
    game.load.image('square+raw_1x1', 'assets/ld36_square+raw_1x1_001.png');
    game.load.image('square+raw_2x2', 'assets/ld36_square+raw_2x2_001.png');
    game.load.image('ld36_bg_001', 'assets/ld36_bg_001.png');
    game.load.image('ld36_blueprint_001', 'assets/ld36_blueprint_001.png');
    game.load.image('ld36_win_001', 'assets/ld36_win_001.png');
    game.load.image('ld36_slots_001', 'assets/ld36_slots_001.png');
    game.load.image('ld36_title_screen_001', 'assets/ld36_title_screen_001.png');
	game.load.audio('ld36_audio_001','sound/ld36_audio_001.ogg');
  }
  function create() {
    game.stage.backgroundColor = GAME_BACKGROUND_COLOR;
    // mon code tout sale
    var titleScreen = game.add.image(0, 0, 'ld36_title_screen_001');
    titleScreen.inputEnabled = true;
    titleScreen.events.onInputDown.addOnce(playGame, this);
    var music = game.add.audio('ld36_audio_001');
	music.play();
    function playGame() {
      game.add.image(0, 0, 'ld36_bg_001');
      var slotsImg = game.add.image(580, 175, 'ld36_slots_001');
      slotsImg.blendMode = PIXI.blendModes.COLOR_BURN;
      var texts = [
        "My loyal servant,\n\nI want you to collect samples from the crafts of an old extinct species named 'humans'.\n\nYou will have to summon and use blocks of ancient materials to rebuild those samples. \n\nDo not disappoint me...\n\n(click to continue)"
      ];
      chainedTextsWithFinalTrigger(0,0, texts, firstLevel);
    }
  }
  function firstLevel() {
    grid = new Grid(game);
    template = new Template(game, 'Pyramid', 'ld36_blueprint_001', 'Level 1 \nPyramid');
    grid.setTemplate(template, PYRAMIDE_GRID);
    grid.spawnsComponents();
  }
  function chainedTextsWithFinalTrigger(x, y, texts, triggerMethod) {
    var current = 0;
    lastText = game.add.text(x, y, texts[current], { font: "24px Georgia", fill: TEXT_COLOR, align: "center", boundsAlignH: "center", boundsAlignV: "middle", wordWrap: true, wordWrapWidth: 460});
    lastText.setTextBounds(GRID_X, GRID_Y, 460, GRID_WIDTH);
    lastText.blendMode = PIXI.blendModes.COLOR_BURN;
    current = current + 1;
    game.input.onDown.addOnce(showNext, {x: x, y: y, lastText: lastText, texts: texts, current: current, method: triggerMethod}, this);
  }
  function showNext() {
    this.lastText.destroy()
    this.lastText = game.add.text(this.x, this.y, this.texts[this.current], { font: "30px Georgia", fill: TEXT_COLOR, align: "center", boundsAlignH: "center", boundsAlignV: "middle", wordWrap: true, wordWrapWidth: 200});
    this.lastText.setTextBounds(590, 20, 200, 115);
    this.lastText.blendMode = PIXI.blendModes.COLOR_BURN;
    this.current = this.current + 1;
    if (this.current <= this.texts.length) {
      game.input.onDown.addOnce(showNext, {x: this.x, y: this.y, lastText: this.lastText, texts: this.texts, current: this.current, method: this.method}, this);
    } else {
      this.method();
    }
  }
</script>
